<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<script th:src="@{/js/jquery-3.7.1.js}"></script>
<head>
<meta charset="UTF-8">
<title>홈화면</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<style>
/* 파일 선택 스타일 */
form {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 20px;
}

input[type="file"] {
    display: none; /* 파일 입력 필드는 숨김 */
}

label.custom-file-label {
    padding: 12px 20px;
    font-size: 16px;
    background-color: #5e72e4;
    color: white;
    border-radius: 25px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    font-weight: bold;
    transition: all 0.3s ease-in-out;
}

label.custom-file-label:hover {
    background-color: #4e61d1;
    transform: scale(1.05);
}

#file-name {
    font-size: 14px;
    color: #555;
    margin-left: 10px;
    font-weight: 500;
    display: inline-block;
    padding: 8px;
    border-radius: 5px;
    background-color: #f1f3f9;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* 선택된 파일이 있을 때 스타일 변경 */
#file-name.selected {
    color: #4e61d1;
    background-color: #e7f0fd;
    padding-left: 12px;
    padding-right: 12px;
}

/* 전체 스타일 */
body {
    font-family: 'Poppins', sans-serif;
    background: #f4f7fb;
    margin: 0;
    padding: 20px;
    color: #333;
}

/* 제목 스타일 */
h1 {
    color: #4c4c4c;
    text-align: center;
    margin-bottom: 20px;
    font-size: 28px;
}

/* 입력 폼 스타일 */
form {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 20px;
}

input[type="text"] {
    padding: 12px;
    width: 320px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease-in-out;
}

input[type="text"]:focus {
    border-color: #5e72e4;
    outline: none;
    box-shadow: 0 0 10px rgba(94, 114, 228, 0.5);
}

/* 버튼 스타일 */
input[type="submit"], input[type="button"] {
    padding: 12px 20px;
    font-size: 16px;
    border: none;
    cursor: pointer;
    border-radius: 25px;
    transition: all 0.3s ease-in-out;
    background-color: #5e72e4;
    color: white;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    font-weight: bold;
}

input[type="submit"]:hover, input[type="button"]:hover {
    background-color: #4e61d1;
    transform: scale(1.05);
}

/* 체크박스 스타일 */
input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

/* 테이블 스타일 */
table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
    text-align: center;
}

th, td {
    padding: 12px;
    border: 1px solid #ddd;
}

th {
    background-color: #f1f3f9;
    color: #333;
    font-size: 18px;
}

tr:nth-child(even) {
    background-color: #f9f9f9;
}

tr:hover {
    background-color: #f1f1f1;
    transition: background 0.3s ease-in-out;
}

/* 현재 페이지 강조 */
.active {
    font-weight: bold;
    color: #5e72e4;
    text-decoration: underline;
}

/* 링크 스타일 */
a {
    text-decoration: none;
    color: #5e72e4;
    font-weight: bold;
    padding: 5px;
    transition: all 0.3s;
}

a:hover {
    text-decoration: underline;
    color: #4e61d1;
    transform: scale(1.1);
}

/* 라벨 스타일 */
label {
    font-size: 16px;
    font-weight: 600;
    color: #5e72e4;
    background: #e7f0fd;
    padding: 8px 15px;
    border-radius: 20px;
    display: inline-block;
    text-align: center;
    transition: all 0.3s ease-in-out;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
}

/* 라벨과 입력 필드 간 간격 */
label + input {
    margin-left: 10px;
}

/* 마우스 오버 효과 */
label:hover {
    background: #d6e3fb;
    transform: scale(1.05);
    color: white;
    cursor: pointer;
}

/* 반응형 (모바일 최적화) */
@media (max-width: 768px) {
    label {
        font-size: 14px;
        padding: 6px 12px;
    }
    input[type="text"] {
        width: 260px;
    }
}
</style>
</head>
<body>
	<h1>파일 목록</h1>
	<form name="create_file_form">
		<label for="file-upload" class="custom-file-label">파일 선택</label>
    	<input type="file" id="file-upload" name="files" multiple onchange="updateFileName()">
    	<span id="file-name">선택된 파일 없음</span>
    	<input type="submit" value="업로드">
	</form>
	<br>
	<div class="container-sm"> <!-- 부트스트랩 반응형 컨테이너? -->
	<table border="1" th:if="${!#lists.isEmpty(attachList)}">
		<thead>
			<tr>
				<th>번호</th>
				<th>다운로드</th>
			</tr>
		</thead>
		<tbody>
			<tr th:if="${!#lists.isEmpty(attachList)}"
				th:each="attach, attachStatus : ${attachList}">
				<td th:text="${attachStatus.count}">
				번호(Status의 count사용)</td>
				<td>
					<a th:text="${attach.oriName}" th:onclick="|location.href='@{/download/{id}(id=${attach.attachNo})}'|">
					파일명</a>
				</td>
			</tr> 
		</tbody>
	</table>
	</div>
	<script>
		// 파일 업로드
		const form1 = document.create_file_form
		form1.addEventListener('submit',(e)=>{
			e.preventDefault();
		const payload1 = new FormData(form1);
			fetch("/attach/create",{
				method:"post",
				body:payload1
			})
			.then(response => response.json())
			.then(data => {
				alert(data.res_msg);
			})
			.catch(error =>{
				alert(data.res_msg);
		})
	})
	// css추가하려고 넣은거임
	function updateFileName() {
	    var input = document.getElementById('file-upload');
	    var fileNameDisplay = document.getElementById('file-name');
	    
	    // 선택된 파일이 있으면 파일 이름을 표시하고 스타일 변경
	    if (input.files.length > 0) {
	        fileNameDisplay.textContent = input.files[0].name;
	        fileNameDisplay.classList.add('selected'); // 선택된 파일 스타일 추가
	    } else {
	        fileNameDisplay.textContent = "선택된 파일 없음";
	        fileNameDisplay.classList.remove('selected'); // 선택된 파일이 없으면 스타일 제거
	    }
	}	
	</script>
	<h1>✨To Do List✨</h1>
	<form action="/" name="search_todo_form" method="get">
		<label for="search">내용 : </label>
		<input type="text" id="search" name="search_text" th:value="${searchDto.search_text}"
				th:selected="${searchDto.search_text}">
		<input type="submit" value="검색">
	</form>
	<br>
	<br>
	<table border="1">
		<thead>
			<tr>
				<th>완료</th>
				<th>번호</th>
				<th>내용</th>
				<th>삭제</th>
			</tr>
		</thead>
		<tbody>
			<tr th:if="${#lists.isEmpty(todoList)}">
				<td colspan="4">조회된 데이터가 없습니다.</td>
			</tr>
			<tr th:if="${!#lists.isEmpty(todoList)}"
				th:each="todo, todoStatus : ${todoList}">
				<td>
					<input type="checkbox" 
					th:checked="${todo.flag == 'Y'}"
					th:value="${todo.flag}"
					th:onchange="|javascript:flagUpdate('${todo.no}')|">
				</td>
				<td th:text="${(pageDto.numPerPage * (pageDto.nowPage-1)) + todoStatus.count}">번호</td>
				<td th:text="${todo.content}">내용</td>
				<td>
					<input type="button" value="삭제" 
					th:onclick="|javascript:todoDelete('${todo.no}')|">
				</td>
			</tr>
		</tbody>
	</table>
	<br>
	<div th:if="${!#lists.isEmpty(todoList)}">
	<a th:if="${pageDto.prev}" 
		th:href="@{/(nowPage=${pageDto.pageBarStart-1})}">&laquo;</a>
	<a th:each="num : ${#numbers.sequence(pageDto.pageBarStart, pageDto.pageBarEnd)}"
		th:text="${num}"
		th:classappend="${pageDto.nowPage == num} ? 'active'"
		th:href="@{/(nowPage=${num},search_text=${searchDto.search_text})}">번호</a>
	<a th:if="${pageDto.next}" th:href="@{/(nowPage=${pageDto.pageBarEnd+1})}">&raquo;</a>
	</div>
	<h1>할 일 추가</h1>
	<form name="create_todo_form" action="/todo">
		<input type="text" name="content" placeholder="할일을 입력하세요.">
		<input type="hidden" name="flag" value="N">
		<input type="submit" value="추가하기">
	</form>

	<script>
		const flagUpdate = function(no){
			fetch('/todo/'+no,{method : 'post',})
			.then(response => response.json())
				.then(data => {
					if(data.res_code == 200){
						location.href="/";
					}else{
						alert(data.res_msg);
					}
						
				})
		}
		const todoDelete = function(no){
			console.log(no);
			if(confirm("할일을 삭제하시겠습니까?")){
				fetch('/todo/'+no,{method:'delete'})
				.then(response => response.json())
				.then(data => {
					alert(data.res_msg);
					if(data.res_code == 200){
						location.href="/";
					}
				})
			}
		}	
		const form = document.create_todo_form;
		form.addEventListener('submit', (e) => {
			e.preventDefault();
			
			let vali_check = false;
			let vali_text = "";
			
			if (!form.content.value) {
				vali_text = "할일을 입력하세요";
			} else {
				vali_check = true;
			}
			
			if (vali_check == false) {
				alert(vali_text);
			} else {
				const payload = new FormData(form);
				fetch("/todo/create", {
					method: "post",
					body: payload
				})
				.then(response => response.json())
				.then(data => {
					alert(data.res_msg);
					
					location.reload(); 
				})
				.catch(error => {
					alert(error);
				});
			}
		});
		
	</script>
</body>
</html>
