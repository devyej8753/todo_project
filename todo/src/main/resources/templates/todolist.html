<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<script th:src="@{/js/jquery-3.7.1.js}"></script>
<head>
<meta charset="UTF-8">
<title>ToDoList</title>
</head>
<body>
	
	<h1>할 일 목록</h1>
	<form action="/" name="search_todo_form" method="get">
		<label for="search">내용 : </label>
		<input type="text" id="search" name="search" th:value="${searchDto != null ? searchDto.search_text : ''}">
		<input type="submit" value="검색">
	</form>
	<br>
	<br>
	<table border="1">
		<thead>
			<tr>
				<th>완료</th>
				<th>번호</th>
				<th>내용</th>
				<th>삭제</th>
			</tr>
		</thead>
		<tbody>
			<tr th:if="${#lists.isEmpty(todoList)}">
				<td colspan="4">게시글이 없습니다.</td>
			</tr>
			<tr th:if="${!#lists.isEmpty(todoList)}"
				th:each="todo, todoStatus : ${todoList}">
				<td><input type="checkbox"></td>
				<td th:text="${(pageDto.numPerPage * (pageDto.nowPage-1)) + todoStatus.count}">번호</td>
				<td th:text="${todo.todoContent}">내용</td>
				<td>
					<input type="button" value="삭제">
				</td>
			</tr>
		</tbody>
	</table>
	<br>

	<a th:if="${pageDto.prev}" th:href="@{/(nowPage=${pageDto.pageBarStart-1})}">&laquo;</a>
	<a th:each="num : ${#numbers.sequence(pageDto.pageBarStart, pageDto.pageBarEnd)}"
		th:text="${num}"
		th:classappend="${pageDto.nowPage == num} ? 'active'"
		th:href="@{/(nowPage=${num})}">번호</a>
	<a th:if="${pageDto.next}"
		th:href="@{/(nowPage=${pageDto.pageBarEnd+1})}">&raquo;</a>

	<h1>할 일 추가</h1>
	<form name="create_todo_form" action="/todo">
		<input type="text" name="todo_content" placeholder="할일을 입력하세요.">
		<input type="hidden" name="todo_flag" value="N">
		<input type="submit" value="추가하기">
	</form>

	<script>
		const todoDelete = function(todoNo){
			
		}	
	
	
	
		const form = document.create_todo_form;
		form.addEventListener('submit', (e) => {
			e.preventDefault();
			
			let vali_check = false;
			let vali_text = "";
			
			if (!form.todo_content.value) {
				vali_text = "할일을 입력하세요";
			} else {
				vali_check = true;
			}
			
			if (vali_check == false) {
				alert(vali_text);
			} else {
				const payload = new FormData(form);
				fetch("/todo", {
					method: "post",
					body: payload
				})
				.then(response => response.json())
				.then(data => {
					alert(data.res_msg);
					
					location.reload(); 
				})
				.catch(error => {
					alert(error);
				});
			}
		});
	</script>
</body>
</html>
